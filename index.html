<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>rCharts NYT Interactive Home Price</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">
  <link rel="icon" type="image/png" href="favicon.ico">
  <style>
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
  </style>
  
<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap.no-responsive.no-icons.min.css" rel="stylesheet">
<!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
<link  rel="stylesheet" 
    href="http://netdna.bootstrapcdn.com/font-awesome/2.0/css/font-awesome.css">
  <link rel="stylesheet" href="libraries/frameworks/bootstrap/css/bootstrap-responsive.min.css">
  
  <link rel="stylesheet" href="libraries/frameworks/bootstrap/css/main.css">
  <link rel="stylesheet" href="libraries/highlighters/prettify/css/twitter-bootstrap.css" />
  <script src="libraries/frameworks/bootstrap/js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="libraries/frameworks/bootstrap/js/vendor/jquery-1.8.2.min.js"><\/script>')</script>
    <link rel=stylesheet href="libraries/widgets/nyt_home/css/base.css"></link>

  <script src="libraries/widgets/nyt_home/js/d3.v3.js"></script>
<script src="libraries/widgets/nyt_home/js/queue.js"></script>

</head>
<body>
   <!--[if lt IE 7]>
     <p class="chromeframe">You are using an outdated browser. 
       <a href="http://browsehappy.com/">Upgrade your browser today</a> or 
       <a href="http://www.google.com/chromeframe/?redirect=true"> 
         install Google Chrome Frame
       </a> to better experience this site.
    </p>
   <![endif]-->
   <!-- Ref: http://twitter.github.com/bootstrap/examples/hero.html -->
   
    <div class="container">
      <h1>Disclaimer and Attribution</h1>
<p><strong>I claim absolutely no credit for this visualization, which I consider one of the most instructive I have ever seen.  All credit belongs to the <a href = "http://www.nytimes.com/interactive/2011/05/31/business/economy/case-shiller-index.html" >original source</a>.  If anybody believes this to be not fair use, I will take it down immediately.  I am implicitly assuming approval for this fork due to the <a href = "http://datastori.es/data-stories-22-nyt-graphics-and-d3-with-mike-bostock-and-shan-carter/">interview</a>.</strong> </p>

<h1>Another Favorite from NYT</h1>

<h1>Reusable Version in rCharts</h1>
<pre><code class="r">require(rCharts)

p1 &lt;- rCharts$new()
p1$field(
  &quot;LIB&quot;,
  list(url = paste0(getwd(),&quot;/libraries/widgets/nyt_home&quot;), name = &quot;&quot;)
)
p1$field(
  &#39;templates&#39;, 
  modifyList(
    p1$templates,
    list( #page = &quot;rChart_nyt_home.html&quot;,
      script = &quot;libraries/widgets/nyt_home/layouts/nyt_home.html&quot;)
  )
)
p1$set(description = &quot;The Standard &amp; Poor&#39;s Case-Shiller Home Price Index for 20 major metropolitan areas is one of the most closely watched gauges of the housing market. The figures for April were released June 25. Figures shown here are not seasonally adjusted or adjusted for inflation.&quot;)

#get the data and convert to a format that we would expect from melted xts
#will be typical
#also original only uses a single value (val) and not other 
data &lt;- read.csv(&quot;data/case-shiller-tiered2.csv&quot;, stringsAsFactors = F)

data.melt &lt;- data.frame(
  format(as.Date(paste(data[,3],data[,4],&quot;01&quot;,sep=&quot;-&quot;),format = &quot;%Y-%m-%d&quot;)),
  data[,c(1,2,5)]
)
colnames(data.melt) &lt;- c(&quot;date&quot;,colnames(data.melt)[-1])


p1$set(data = data.melt)
p1$set(groups = &quot;citycode&quot;)
#cat(noquote(p1$html()))
</code></pre>

<h1>Now With Our Own Data</h1>
<pre><code class="r">p2 &lt;- rCharts$new()
p2$field(
  &quot;LIB&quot;,
  list(url = paste0(getwd(),&quot;/libraries/widgets/nyt_home&quot;), name = &quot;&quot;)
)
p2$field(
  &#39;templates&#39;, 
  modifyList(
    p1$templates,
    list( #page = &quot;rChart_nyt_home.html&quot;,
      script = &quot;libraries/widgets/nyt_home/layouts/nyt_home.html&quot;)
  )
)
p2$set(description = &quot;This data comes from the managers dataset included in the R package PerformanceAnalytics.&quot;)

#get the data and convert to a format that we would expect from melted xts
#will be typical
#also original only uses a single value (val) and not other 
require(reshape2)
require(PerformanceAnalytics)

data(managers)
managers.melt &lt;- melt(
  data.frame( index( managers ), coredata(cumprod( managers+1 )*100 ) ),
  id.vars = 1
)
colnames(managers.melt) &lt;- c(&quot;date&quot;, &quot;manager&quot;,&quot;val&quot;)
managers.melt[,&quot;date&quot;] &lt;- format(managers.melt[,&quot;date&quot;],format = &quot;%Y-%m-%d&quot;)
p2$set(data = managers.melt)
p2$set(groups = &quot;manager&quot;)
cat(noquote(p2$html()))
</code></pre>

<!--Attribution:NYT Interactive http://www.nytimes.com/interactive/2011/05/31/business/economy/case-shiller-index.html-->

<div id="interactiveFreeFormMain">
<div class="g-shell">
<div class="g-tooltip">
<span class="g-playername-tooltip"></span>
<span class="g-dltype-tooltip"></span>
<span class="g-salary-tooltip"></span>
</div>

<h5 class="g-intro-sentence">
If you bought
<span class="g-selector g-city-selector"></span>
around
<span class="g-selector g-month-selector"></span>
<span class="g-selector g-date-selector"></span>
it would be worth
<span class="g-answer">24 percent less</span> today.
</h5>

<div class="g-chart"></div>

<div class="g-table-container">
<div class="g-table-intro">
<h4>Behind the data </h4>
<p class="g-table-readin"></p>
</div>

<table class="g-table">
<tr>
<th class="g-proper-city"></th>
<th class="g-yoy-chg" colspan="2">Year-over-year change</th>
<th class="g-peak-month-td" colspan="2">Since peak</th>
<th class="g-change-since-selected" colspan="2"> <span class="g-date-compare">Since Jan. 2000</span></th>
</tr>
</table>

<p></div>
</div></p>

<script>
(function() {
  var params = {
 "dom": "chart319817337dff",
"width":    800,
"height":    400,
"description": "This data comes from the managers dataset included in the R package PerformanceAnalytics.",
"data": {
 "date": [ "1996-01-31", "1996-02-29", "1996-03-31", "1996-04-30", "1996-05-31", "1996-06-30", "1996-07-31", "1996-08-31", "1996-09-30", "1996-10-31", "1996-11-30", "1996-12-31", "1997-01-31", "1997-02-28", "1997-03-31", "1997-04-30", "1997-05-31", "1997-06-30", "1997-07-31", "1997-08-31", "1997-09-30", "1997-10-31", "1997-11-30", "1997-12-31", "1998-01-31", "1998-02-28", "1998-03-31", "1998-04-30", "1998-05-31", "1998-06-30", "1998-07-31", "1998-08-31", "1998-09-30", "1998-10-31", "1998-11-30", "1998-12-31", "1999-01-31", "1999-02-28", "1999-03-31", "1999-04-30", "1999-05-31", "1999-06-30", "1999-07-31", "1999-08-31", "1999-09-30", "1999-10-31", "1999-11-30", "1999-12-31", "2000-01-31", "2000-02-29", "2000-03-31", "2000-04-30", "2000-05-31", "2000-06-30", "2000-07-31", "2000-08-31", "2000-09-30", "2000-10-31", "2000-11-30", "2000-12-31", "2001-01-31", "2001-02-28", "2001-03-31", "2001-04-30", "2001-05-31", "2001-06-30", "2001-07-31", "2001-08-31", "2001-09-30", "2001-10-31", "2001-11-30", "2001-12-31", "2002-01-31", "2002-02-28", "2002-03-31", "2002-04-30", "2002-05-31", "2002-06-30", "2002-07-31", "2002-08-31", "2002-09-30", "2002-10-31", "2002-11-30", "2002-12-31", "2003-01-31", "2003-02-28", "2003-03-31", "2003-04-30", "2003-05-31", "2003-06-30", "2003-07-31", "2003-08-31", "2003-09-30", "2003-10-31", "2003-11-30", "2003-12-31", "2004-01-31", "2004-02-29", "2004-03-31", "2004-04-30", "2004-05-31", "2004-06-30", "2004-07-31", "2004-08-31", "2004-09-30", "2004-10-31", "2004-11-30", "2004-12-31", "2005-01-31", "2005-02-28", "2005-03-31", "2005-04-30", "2005-05-31", "2005-06-30", "2005-07-31", "2005-08-31", "2005-09-30", "2005-10-31", "2005-11-30", "2005-12-31", "2006-01-31", "2006-02-28", "2006-03-31", "2006-04-30", "2006-05-31", "2006-06-30", "2006-07-31", "2006-08-31", "2006-09-30", "2006-10-31", "2006-11-30", "2006-12-31", "1996-01-31", "1996-02-29", "1996-03-31", "1996-04-30", "1996-05-31", "1996-06-30", "1996-07-31", "1996-08-31", "1996-09-30", "1996-10-31", "1996-11-30", "1996-12-31", "1997-01-31", "1997-02-28", "1997-03-31", "1997-04-30", "1997-05-31", "1997-06-30", "1997-07-31", "1997-08-31", "1997-09-30", "1997-10-31", "1997-11-30", "1997-12-31", "1998-01-31", "1998-02-28", "1998-03-31", "1998-04-30", "1998-05-31", "1998-06-30", "1998-07-31", "1998-08-31", "1998-09-30", "1998-10-31", "1998-11-30", "1998-12-31", "1999-01-31", "1999-02-28", "1999-03-31", "1999-04-30", "1999-05-31", "1999-06-30", "1999-07-31", "1999-08-31", "1999-09-30", "1999-10-31", "1999-11-30", "1999-12-31", "2000-01-31", "2000-02-29", "2000-03-31", "2000-04-30", "2000-05-31", "2000-06-30", "2000-07-31", "2000-08-31", "2000-09-30", "2000-10-31", "2000-11-30", "2000-12-31", "2001-01-31", "2001-02-28", "2001-03-31", "2001-04-30", "2001-05-31", "2001-06-30", "2001-07-31", "2001-08-31", "2001-09-30", "2001-10-31", "2001-11-30", "2001-12-31", "2002-01-31", "2002-02-28", "2002-03-31", "2002-04-30", "2002-05-31", "2002-06-30", "2002-07-31", "2002-08-31", "2002-09-30", "2002-10-31", "2002-11-30", "2002-12-31", "2003-01-31", "2003-02-28", "2003-03-31", "2003-04-30", "2003-05-31", "2003-06-30", "2003-07-31", "2003-08-31", "2003-09-30", "2003-10-31", "2003-11-30", "2003-12-31", "2004-01-31", "2004-02-29", "2004-03-31", "2004-04-30", "2004-05-31", "2004-06-30", "2004-07-31", "2004-08-31", "2004-09-30", "2004-10-31", "2004-11-30", "2004-12-31", "2005-01-31", "2005-02-28", "2005-03-31", "2005-04-30", "2005-05-31", "2005-06-30", "2005-07-31", "2005-08-31", "2005-09-30", "2005-10-31", "2005-11-30", "2005-12-31", "2006-01-31", "2006-02-28", "2006-03-31", "2006-04-30", "2006-05-31", "2006-06-30", "2006-07-31", "2006-08-31", "2006-09-30", "2006-10-31", "2006-11-30", "2006-12-31", "1996-01-31", "1996-02-29", "1996-03-31", "1996-04-30", "1996-05-31", "1996-06-30", "1996-07-31", "1996-08-31", "1996-09-30", "1996-10-31", "1996-11-30", "1996-12-31", "1997-01-31", "1997-02-28", "1997-03-31", "1997-04-30", "1997-05-31", "1997-06-30", "1997-07-31", "1997-08-31", "1997-09-30", "1997-10-31", "1997-11-30", "1997-12-31", "1998-01-31", "1998-02-28", "1998-03-31", "1998-04-30", "1998-05-31", "1998-06-30", "1998-07-31", "1998-08-31", "1998-09-30", "1998-10-31", "1998-11-30", "1998-12-31", "1999-01-31", "1999-02-28", "1999-03-31", "1999-04-30", "1999-05-31", "1999-06-30", "1999-07-31", "1999-08-31", "1999-09-30", "1999-10-31", "1999-11-30", "1999-12-31", "2000-01-31", "2000-02-29", "2000-03-31", "2000-04-30", "2000-05-31", "2000-06-30", "2000-07-31", "2000-08-31", "2000-09-30", "2000-10-31", "2000-11-30", "2000-12-31", "2001-01-31", "2001-02-28", "2001-03-31", "2001-04-30", "2001-05-31", "2001-06-30", "2001-07-31", "2001-08-31", "2001-09-30", "2001-10-31", "2001-11-30", "2001-12-31", "2002-01-31", "2002-02-28", "2002-03-31", "2002-04-30", "2002-05-31", "2002-06-30", "2002-07-31", "2002-08-31", "2002-09-30", "2002-10-31", "2002-11-30", "2002-12-31", "2003-01-31", "2003-02-28", "2003-03-31", "2003-04-30", "2003-05-31", "2003-06-30", "2003-07-31", "2003-08-31", "2003-09-30", "2003-10-31", "2003-11-30", "2003-12-31", "2004-01-31", "2004-02-29", "2004-03-31", "2004-04-30", "2004-05-31", "2004-06-30", "2004-07-31", "2004-08-31", "2004-09-30", "2004-10-31", "2004-11-30", "2004-12-31", "2005-01-31", "2005-02-28", "2005-03-31", "2005-04-30", "2005-05-31", "2005-06-30", "2005-07-31", "2005-08-31", "2005-09-30", "2005-10-31", "2005-11-30", "2005-12-31", "2006-01-31", "2006-02-28", "2006-03-31", "2006-04-30", "2006-05-31", "2006-06-30", "2006-07-31", "2006-08-31", "2006-09-30", "2006-10-31", "2006-11-30", "2006-12-31", "1996-01-31", "1996-02-29", "1996-03-31", "1996-04-30", "1996-05-31", "1996-06-30", "1996-07-31", "1996-08-31", "1996-09-30", "1996-10-31", "1996-11-30", "1996-12-31", "1997-01-31", "1997-02-28", "1997-03-31", "1997-04-30", "1997-05-31", "1997-06-30", "1997-07-31", "1997-08-31", "1997-09-30", "1997-10-31", "1997-11-30", "1997-12-31", "1998-01-31", "1998-02-28", "1998-03-31", "1998-04-30", "1998-05-31", "1998-06-30", "1998-07-31", "1998-08-31", "1998-09-30", "1998-10-31", "1998-11-30", "1998-12-31", "1999-01-31", "1999-02-28", "1999-03-31", "1999-04-30", "1999-05-31", "1999-06-30", "1999-07-31", "1999-08-31", "1999-09-30", "1999-10-31", "1999-11-30", "1999-12-31", "2000-01-31", "2000-02-29", "2000-03-31", "2000-04-30", "2000-05-31", "2000-06-30", "2000-07-31", "2000-08-31", "2000-09-30", "2000-10-31", "2000-11-30", "2000-12-31", "2001-01-31", "2001-02-28", "2001-03-31", "2001-04-30", "2001-05-31", "2001-06-30", "2001-07-31", "2001-08-31", "2001-09-30", "2001-10-31", "2001-11-30", "2001-12-31", "2002-01-31", "2002-02-28", "2002-03-31", "2002-04-30", "2002-05-31", "2002-06-30", "2002-07-31", "2002-08-31", "2002-09-30", "2002-10-31", "2002-11-30", "2002-12-31", "2003-01-31", "2003-02-28", "2003-03-31", "2003-04-30", "2003-05-31", "2003-06-30", "2003-07-31", "2003-08-31", "2003-09-30", "2003-10-31", "2003-11-30", "2003-12-31", "2004-01-31", "2004-02-29", "2004-03-31", "2004-04-30", "2004-05-31", "2004-06-30", "2004-07-31", "2004-08-31", "2004-09-30", "2004-10-31", "2004-11-30", "2004-12-31", "2005-01-31", "2005-02-28", "2005-03-31", "2005-04-30", "2005-05-31", "2005-06-30", "2005-07-31", "2005-08-31", "2005-09-30", "2005-10-31", "2005-11-30", "2005-12-31", "2006-01-31", "2006-02-28", "2006-03-31", "2006-04-30", "2006-05-31", "2006-06-30", "2006-07-31", "2006-08-31", "2006-09-30", "2006-10-31", "2006-11-30", "2006-12-31", "1996-01-31", "1996-02-29", "1996-03-31", "1996-04-30", "1996-05-31", "1996-06-30", "1996-07-31", "1996-08-31", "1996-09-30", "1996-10-31", "1996-11-30", "1996-12-31", "1997-01-31", "1997-02-28", "1997-03-31", "1997-04-30", "1997-05-31", "1997-06-30", "1997-07-31", "1997-08-31", "1997-09-30", "1997-10-31", "1997-11-30", "1997-12-31", "1998-01-31", "1998-02-28", "1998-03-31", "1998-04-30", "1998-05-31", "1998-06-30", "1998-07-31", "1998-08-31", "1998-09-30", "1998-10-31", "1998-11-30", "1998-12-31", "1999-01-31", "1999-02-28", "1999-03-31", "1999-04-30", "1999-05-31", "1999-06-30", "1999-07-31", "1999-08-31", "1999-09-30", "1999-10-31", "1999-11-30", "1999-12-31", "2000-01-31", "2000-02-29", "2000-03-31", "2000-04-30", "2000-05-31", "2000-06-30", "2000-07-31", "2000-08-31", "2000-09-30", "2000-10-31", "2000-11-30", "2000-12-31", "2001-01-31", "2001-02-28", "2001-03-31", "2001-04-30", "2001-05-31", "2001-06-30", "2001-07-31", "2001-08-31", "2001-09-30", "2001-10-31", "2001-11-30", "2001-12-31", "2002-01-31", "2002-02-28", "2002-03-31", "2002-04-30", "2002-05-31", "2002-06-30", "2002-07-31", "2002-08-31", "2002-09-30", "2002-10-31", "2002-11-30", "2002-12-31", "2003-01-31", "2003-02-28", "2003-03-31", "2003-04-30", "2003-05-31", "2003-06-30", "2003-07-31", "2003-08-31", "2003-09-30", "2003-10-31", "2003-11-30", "2003-12-31", "2004-01-31", "2004-02-29", "2004-03-31", "2004-04-30", "2004-05-31", "2004-06-30", "2004-07-31", "2004-08-31", "2004-09-30", "2004-10-31", "2004-11-30", "2004-12-31", "2005-01-31", "2005-02-28", "2005-03-31", "2005-04-30", "2005-05-31", "2005-06-30", "2005-07-31", "2005-08-31", "2005-09-30", "2005-10-31", "2005-11-30", "2005-12-31", "2006-01-31", "2006-02-28", "2006-03-31", "2006-04-30", "2006-05-31", "2006-06-30", "2006-07-31", "2006-08-31", "2006-09-30", "2006-10-31", "2006-11-30", "2006-12-31", "1996-01-31", "1996-02-29", "1996-03-31", "1996-04-30", "1996-05-31", "1996-06-30", "1996-07-31", "1996-08-31", "1996-09-30", "1996-10-31", "1996-11-30", "1996-12-31", "1997-01-31", "1997-02-28", "1997-03-31", "1997-04-30", "1997-05-31", "1997-06-30", "1997-07-31", "1997-08-31", "1997-09-30", "1997-10-31", "1997-11-30", "1997-12-31", "1998-01-31", "1998-02-28", "1998-03-31", "1998-04-30", "1998-05-31", "1998-06-30", "1998-07-31", "1998-08-31", "1998-09-30", "1998-10-31", "1998-11-30", "1998-12-31", "1999-01-31", "1999-02-28", "1999-03-31", "1999-04-30", "1999-05-31", "1999-06-30", "1999-07-31", "1999-08-31", "1999-09-30", "1999-10-31", "1999-11-30", "1999-12-31", "2000-01-31", "2000-02-29", "2000-03-31", "2000-04-30", "2000-05-31", "2000-06-30", "2000-07-31", "2000-08-31", "2000-09-30", "2000-10-31", "2000-11-30", "2000-12-31", "2001-01-31", "2001-02-28", "2001-03-31", "2001-04-30", "2001-05-31", "2001-06-30", "2001-07-31", "2001-08-31", "2001-09-30", "2001-10-31", "2001-11-30", "2001-12-31", "2002-01-31", "2002-02-28", "2002-03-31", "2002-04-30", "2002-05-31", "2002-06-30", "2002-07-31", "2002-08-31", "2002-09-30", "2002-10-31", "2002-11-30", "2002-12-31", "2003-01-31", "2003-02-28", "2003-03-31", "2003-04-30", "2003-05-31", "2003-06-30", "2003-07-31", "2003-08-31", "2003-09-30", "2003-10-31", "2003-11-30", "2003-12-31", "2004-01-31", "2004-02-29", "2004-03-31", "2004-04-30", "2004-05-31", "2004-06-30", "2004-07-31", "2004-08-31", "2004-09-30", "2004-10-31", "2004-11-30", "2004-12-31", "2005-01-31", "2005-02-28", "2005-03-31", "2005-04-30", "2005-05-31", "2005-06-30", "2005-07-31", "2005-08-31", "2005-09-30", "2005-10-31", "2005-11-30", "2005-12-31", "2006-01-31", "2006-02-28", "2006-03-31", "2006-04-30", "2006-05-31", "2006-06-30", "2006-07-31", "2006-08-31", "2006-09-30", "2006-10-31", "2006-11-30", "2006-12-31", "1996-01-31", "1996-02-29", "1996-03-31", "1996-04-30", "1996-05-31", "1996-06-30", "1996-07-31", "1996-08-31", "1996-09-30", "1996-10-31", "1996-11-30", "1996-12-31", "1997-01-31", "1997-02-28", "1997-03-31", "1997-04-30", "1997-05-31", "1997-06-30", "1997-07-31", "1997-08-31", "1997-09-30", "1997-10-31", "1997-11-30", "1997-12-31", "1998-01-31", "1998-02-28", "1998-03-31", "1998-04-30", "1998-05-31", "1998-06-30", "1998-07-31", "1998-08-31", "1998-09-30", "1998-10-31", "1998-11-30", "1998-12-31", "1999-01-31", "1999-02-28", "1999-03-31", "1999-04-30", "1999-05-31", "1999-06-30", "1999-07-31", "1999-08-31", "1999-09-30", "1999-10-31", "1999-11-30", "1999-12-31", "2000-01-31", "2000-02-29", "2000-03-31", "2000-04-30", "2000-05-31", "2000-06-30", "2000-07-31", "2000-08-31", "2000-09-30", "2000-10-31", "2000-11-30", "2000-12-31", "2001-01-31", "2001-02-28", "2001-03-31", "2001-04-30", "2001-05-31", "2001-06-30", "2001-07-31", "2001-08-31", "2001-09-30", "2001-10-31", "2001-11-30", "2001-12-31", "2002-01-31", "2002-02-28", "2002-03-31", "2002-04-30", "2002-05-31", "2002-06-30", "2002-07-31", "2002-08-31", "2002-09-30", "2002-10-31", "2002-11-30", "2002-12-31", "2003-01-31", "2003-02-28", "2003-03-31", "2003-04-30", "2003-05-31", "2003-06-30", "2003-07-31", "2003-08-31", "2003-09-30", "2003-10-31", "2003-11-30", "2003-12-31", "2004-01-31", "2004-02-29", "2004-03-31", "2004-04-30", "2004-05-31", "2004-06-30", "2004-07-31", "2004-08-31", "2004-09-30", "2004-10-31", "2004-11-30", "2004-12-31", "2005-01-31", "2005-02-28", "2005-03-31", "2005-04-30", "2005-05-31", "2005-06-30", "2005-07-31", "2005-08-31", "2005-09-30", "2005-10-31", "2005-11-30", "2005-12-31", "2006-01-31", "2006-02-28", "2006-03-31", "2006-04-30", "2006-05-31", "2006-06-30", "2006-07-31", "2006-08-31", "2006-09-30", "2006-10-31", "2006-11-30", "2006-12-31", "1996-01-31", "1996-02-29", "1996-03-31", "1996-04-30", "1996-05-31", "1996-06-30", "1996-07-31", "1996-08-31", "1996-09-30", "1996-10-31", "1996-11-30", "1996-12-31", "1997-01-31", "1997-02-28", "1997-03-31", "1997-04-30", "1997-05-31", "1997-06-30", "1997-07-31", "1997-08-31", "1997-09-30", "1997-10-31", "1997-11-30", "1997-12-31", "1998-01-31", "1998-02-28", "1998-03-31", "1998-04-30", "1998-05-31", "1998-06-30", "1998-07-31", "1998-08-31", "1998-09-30", "1998-10-31", "1998-11-30", "1998-12-31", "1999-01-31", "1999-02-28", "1999-03-31", "1999-04-30", "1999-05-31", "1999-06-30", "1999-07-31", "1999-08-31", "1999-09-30", "1999-10-31", "1999-11-30", "1999-12-31", "2000-01-31", "2000-02-29", "2000-03-31", "2000-04-30", "2000-05-31", "2000-06-30", "2000-07-31", "2000-08-31", "2000-09-30", "2000-10-31", "2000-11-30", "2000-12-31", "2001-01-31", "2001-02-28", "2001-03-31", "2001-04-30", "2001-05-31", "2001-06-30", "2001-07-31", "2001-08-31", "2001-09-30", "2001-10-31", "2001-11-30", "2001-12-31", "2002-01-31", "2002-02-28", "2002-03-31", "2002-04-30", "2002-05-31", "2002-06-30", "2002-07-31", "2002-08-31", "2002-09-30", "2002-10-31", "2002-11-30", "2002-12-31", "2003-01-31", "2003-02-28", "2003-03-31", "2003-04-30", "2003-05-31", "2003-06-30", "2003-07-31", "2003-08-31", "2003-09-30", "2003-10-31", "2003-11-30", "2003-12-31", "2004-01-31", "2004-02-29", "2004-03-31", "2004-04-30", "2004-05-31", "2004-06-30", "2004-07-31", "2004-08-31", "2004-09-30", "2004-10-31", "2004-11-30", "2004-12-31", "2005-01-31", "2005-02-28", "2005-03-31", "2005-04-30", "2005-05-31", "2005-06-30", "2005-07-31", "2005-08-31", "2005-09-30", "2005-10-31", "2005-11-30", "2005-12-31", "2006-01-31", "2006-02-28", "2006-03-31", "2006-04-30", "2006-05-31", "2006-06-30", "2006-07-31", "2006-08-31", "2006-09-30", "2006-10-31", "2006-11-30", "2006-12-31", "1996-01-31", "1996-02-29", "1996-03-31", "1996-04-30", "1996-05-31", "1996-06-30", "1996-07-31", "1996-08-31", "1996-09-30", "1996-10-31", "1996-11-30", "1996-12-31", "1997-01-31", "1997-02-28", "1997-03-31", "1997-04-30", "1997-05-31", "1997-06-30", "1997-07-31", "1997-08-31", "1997-09-30", "1997-10-31", "1997-11-30", "1997-12-31", "1998-01-31", "1998-02-28", "1998-03-31", "1998-04-30", "1998-05-31", "1998-06-30", "1998-07-31", "1998-08-31", "1998-09-30", "1998-10-31", "1998-11-30", "1998-12-31", "1999-01-31", "1999-02-28", "1999-03-31", "1999-04-30", "1999-05-31", "1999-06-30", "1999-07-31", "1999-08-31", "1999-09-30", "1999-10-31", "1999-11-30", "1999-12-31", "2000-01-31", "2000-02-29", "2000-03-31", "2000-04-30", "2000-05-31", "2000-06-30", "2000-07-31", "2000-08-31", "2000-09-30", "2000-10-31", "2000-11-30", "2000-12-31", "2001-01-31", "2001-02-28", "2001-03-31", "2001-04-30", "2001-05-31", "2001-06-30", "2001-07-31", "2001-08-31", "2001-09-30", "2001-10-31", "2001-11-30", "2001-12-31", "2002-01-31", "2002-02-28", "2002-03-31", "2002-04-30", "2002-05-31", "2002-06-30", "2002-07-31", "2002-08-31", "2002-09-30", "2002-10-31", "2002-11-30", "2002-12-31", "2003-01-31", "2003-02-28", "2003-03-31", "2003-04-30", "2003-05-31", "2003-06-30", "2003-07-31", "2003-08-31", "2003-09-30", "2003-10-31", "2003-11-30", "2003-12-31", "2004-01-31", "2004-02-29", "2004-03-31", "2004-04-30", "2004-05-31", "2004-06-30", "2004-07-31", "2004-08-31", "2004-09-30", "2004-10-31", "2004-11-30", "2004-12-31", "2005-01-31", "2005-02-28", "2005-03-31", "2005-04-30", "2005-05-31", "2005-06-30", "2005-07-31", "2005-08-31", "2005-09-30", "2005-10-31", "2005-11-30", "2005-12-31", "2006-01-31", "2006-02-28", "2006-03-31", "2006-04-30", "2006-05-31", "2006-06-30", "2006-07-31", "2006-08-31", "2006-09-30", "2006-10-31", "2006-11-30", "2006-12-31", "1996-01-31", "1996-02-29", "1996-03-31", "1996-04-30", "1996-05-31", "1996-06-30", "1996-07-31", "1996-08-31", "1996-09-30", "1996-10-31", "1996-11-30", "1996-12-31", "1997-01-31", "1997-02-28", "1997-03-31", "1997-04-30", "1997-05-31", "1997-06-30", "1997-07-31", "1997-08-31", "1997-09-30", "1997-10-31", "1997-11-30", "1997-12-31", "1998-01-31", "1998-02-28", "1998-03-31", "1998-04-30", "1998-05-31", "1998-06-30", "1998-07-31", "1998-08-31", "1998-09-30", "1998-10-31", "1998-11-30", "1998-12-31", "1999-01-31", "1999-02-28", "1999-03-31", "1999-04-30", "1999-05-31", "1999-06-30", "1999-07-31", "1999-08-31", "1999-09-30", "1999-10-31", "1999-11-30", "1999-12-31", "2000-01-31", "2000-02-29", "2000-03-31", "2000-04-30", "2000-05-31", "2000-06-30", "2000-07-31", "2000-08-31", "2000-09-30", "2000-10-31", "2000-11-30", "2000-12-31", "2001-01-31", "2001-02-28", "2001-03-31", "2001-04-30", "2001-05-31", "2001-06-30", "2001-07-31", "2001-08-31", "2001-09-30", "2001-10-31", "2001-11-30", "2001-12-31", "2002-01-31", "2002-02-28", "2002-03-31", "2002-04-30", "2002-05-31", "2002-06-30", "2002-07-31", "2002-08-31", "2002-09-30", "2002-10-31", "2002-11-30", "2002-12-31", "2003-01-31", "2003-02-28", "2003-03-31", "2003-04-30", "2003-05-31", "2003-06-30", "2003-07-31", "2003-08-31", "2003-09-30", "2003-10-31", "2003-11-30", "2003-12-31", "2004-01-31", "2004-02-29", "2004-03-31", "2004-04-30", "2004-05-31", "2004-06-30", "2004-07-31", "2004-08-31", "2004-09-30", "2004-10-31", "2004-11-30", "2004-12-31", "2005-01-31", "2005-02-28", "2005-03-31", "2005-04-30", "2005-05-31", "2005-06-30", "2005-07-31", "2005-08-31", "2005-09-30", "2005-10-31", "2005-11-30", "2005-12-31", "2006-01-31", "2006-02-28", "2006-03-31", "2006-04-30", "2006-05-31", "2006-06-30", "2006-07-31", "2006-08-31", "2006-09-30", "2006-10-31", "2006-11-30", "2006-12-31" ],
"manager": [ "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM1", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM2", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM3", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM4", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM5", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "HAM6", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "EDHEC.LS.EQ", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "SP500.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.10Y.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR", "US.3m.TR" ],
"val": [ 100.74, 102.68, 104.28, 103.33, 104.11, 103.71, 101.31, 105.31, 106.86, 109.94, 111.65, 113.62, 116.03, 116.28, 117.38, 118.85, 124.06, 126.93, 128.88, 131.93, 134.82, 132.03, 135.33, 136.82, 137.59, 143.49, 148.69, 149.85, 146.38, 148.16, 144.97, 131.29, 134.54, 142.05, 143.84, 145.23, 143.88, 145.24, 151.95, 159.69, 162.28, 167.57, 169.21, 166.42, 165.67, 165.57, 166.15,  168.6, 166.88, 168.93, 178.64, 182.25, 188.43, 190.75, 191.68,  199.1, 199.36, 197.82, 199.88, 198.52, 200.09, 201.73, 199.61,  206.5, 218.45, 218.91, 223.44, 227.04, 219.96,  220.2, 227.69, 243.08, 246.36, 243.31, 244.84, 245.96,  245.6, 239.68, 221.58, 223.29, 210.45,  216.7, 231.02, 223.56, 214.35, 208.97, 216.58, 230.68, 238.45, 245.79, 250.12, 250.19, 252.45, 264.59, 269.06, 276.46, 277.92,  277.9, 280.31, 279.11,  281.4, 288.69, 288.69, 290.27, 292.83, 292.65, 304.18, 317.57,  317.6, 324.43, 317.71, 311.07, 312.41, 317.44, 320.33, 323.95,  332.4, 326.19, 333.72, 342.43, 366.13, 371.44, 386.18, 385.76, 375.46, 383.57, 378.04, 384.13, 386.74, 403.26, 407.98, 412.67, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 103.49, 107.12, 109.89, 114.82, 118.87, 115.27, 111.39, 116.52, 124.13, 129.03, 137.63, 140.57, 151.41, 145.75, 140.85, 144.88, 155.88, 156.72, 173.66, 173.17, 182.68, 176.21, 179.31, 179.26, 188.06, 196.83, 200.92, 205.62, 202.82, 210.84, 210.94,  195.8, 208.82, 207.75, 219.28, 229.46, 235.63, 223.14, 227.31, 236.79, 238.66, 251.72, 252.77, 255.86,  257.6, 276.84, 306.57, 324.35, 322.73,  380.7, 381.76, 376.91, 368.32, 383.31, 363.19, 392.06, 369.59, 375.58, 361.76, 367.87, 377.51, 364.11, 360.11, 364.86, 362.93, 354.32, 353.54, 344.85,  342.5, 335.48,  343.8, 344.42, 339.43, 325.37, 332.11, 323.71, 322.93, 308.37, 297.88,  298.6, 285.49,  288.4, 298.49, 279.03, 278.61,  279.2,  282.3, 297.12, 309.69, 313.06, 315.75, 325.29, 324.48, 344.11, 348.17, 351.48, 353.37, 358.43, 357.06, 349.92, 347.58, 347.93, 335.85, 333.97,  332.9, 332.54, 350.96, 357.31, 359.92, 374.93, 378.42,  377.7,  386.5, 387.85, 395.72, 394.93, 402.71, 398.24, 404.69, 412.02, 426.48, 437.83, 443.04, 444.41, 434.99, 426.77, 431.12, 442.03, 445.21, 453.36, 465.55, 470.67, 102.22, 104.21, 103.19, 105.63, 105.92, 105.72, 101.01, 104.55, 112.47, 110.44,  115.5, 120.57, 125.84, 129.77, 131.23, 135.88,  146.6, 152.64, 164.76, 167.11, 170.74,  171.7, 170.55, 172.52, 171.82, 177.38, 184.55, 189.02, 188.13, 185.63, 172.21, 141.91, 149.71, 142.18, 154.79, 153.11, 159.39, 150.64, 141.38, 151.05, 160.64, 162.13, 166.17, 159.41, 155.72, 159.66, 155.27, 156.67, 163.31, 170.97, 166.41, 157.07, 158.75, 169.33, 164.82, 173.89, 183.56, 168.52, 156.12, 163.39, 177.51,  168.1,  165.5, 170.08, 195.73, 180.42, 170.39, 156.28, 139.48,    146,  156.7, 174.55, 168.54, 164.28, 186.92, 198.28, 198.64, 189.24, 162.63, 159.51, 141.81,  143.1, 154.69, 160.16, 154.69, 153.96, 157.84, 175.94, 191.67, 200.87, 207.32,  205.6, 207.49, 220.65, 239.64, 251.34, 254.66, 265.89, 271.36, 248.05, 243.59, 244.71, 236.46, 243.65, 253.54, 251.79,  273.3, 286.11, 287.32, 278.18, 272.12, 269.56, 272.93, 292.58, 311.07, 302.92, 292.86, 284.28, 302.39, 313.03, 330.31, 312.51, 315.85, 321.54, 315.62, 320.48, 316.64, 310.84, 316.97, 333.38, 345.82, 352.94, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null,  103.4, 104.36, 105.36, 106.91, 109.67, 110.09, 105.22, 107.44, 113.49, 116.62, 125.44, 122.96, 130.64, 131.66, 126.25, 133.79, 141.93, 148.29,  160.1, 151.13, 159.41, 154.09, 161.22,    164, 165.82, 177.77, 186.87, 188.76, 185.51, 193.05,    191, 163.38, 173.85, 187.99, 199.38, 210.86, 219.68, 212.85, 221.36, 229.93,  224.5, 236.96, 229.57, 228.44, 222.18, 236.25, 241.04, 255.24, 242.43, 237.85, 261.11, 253.25, 248.06, 254.18, 250.22, 265.76, 251.72, 250.67, 230.91, 232.05, 240.28, 218.37, 204.52, 220.42, 221.89,  216.5, 214.38, 200.96, 184.72, 188.25, 202.69, 204.47, 201.49,  197.6, 205.03,  192.6, 191.18, 177.57, 163.72,  164.8, 146.88, 159.81, 169.22, 159.29, 155.11, 152.79, 154.27, 166.98, 175.78, 178.03, 181.17,  184.7, 182.74, 193.08, 194.78, 204.99, 208.76, 211.66, 208.47, 205.19, 208.01, 212.06, 205.04, 205.88, 208.11, 211.29, 219.85, 227.32, 221.78, 226.45, 222.44, 218.21, 225.15, 225.47, 233.86, 231.73, 233.61, 229.71, 238.39, 238.46, 244.78, 245.44, 248.51, 251.84, 244.59, 244.93, 246.45, 252.32, 258.83, 267.26, 272.34, 276.16, 100.38, 96.835, 95.811, 94.145, 93.634, 95.045,  94.95, 94.524, 96.631, 99.404, 102.18, 100.04, 99.989, 99.822, 97.868,  99.78, 100.81, 102.49, 106.75, 104.46, 106.71, 109.51, 109.77, 111.21, 113.51, 112.55, 112.73,  113.1, 114.35, 115.86, 115.92, 120.47, 126.56,  125.3, 124.13, 125.41, 125.93, 120.29, 121.36, 120.84, 118.53, 117.43, 117.16, 116.56, 117.87,  117.3, 116.63, 115.06, 113.83, 115.73,  119.7, 118.57, 118.62, 121.47, 121.97, 123.97, 123.95, 124.94, 128.33, 132.16, 132.29, 134.22, 134.61,  131.1, 131.01, 131.62, 135.77, 137.85, 140.99, 144.93, 140.25, 137.79, 138.47, 140.24, 135.03,  138.9, 140.07, 142.95, 147.44, 151.84, 158.95, 155.76, 152.53, 157.93, 156.56, 160.89, 159.75,  159.8, 167.25, 165.27, 153.55,  155.2, 162.26, 158.23, 158.69, 160.01, 162.21, 164.92, 167.43, 159.34, 158.25, 159.32, 161.67,  166.7, 167.35, 169.12, 165.27, 167.74, 169.45, 166.87, 165.66, 170.18, 173.15, 174.57, 170.49, 174.36, 170.66,  168.2, 169.07, 171.08, 169.95, 169.72, 166.35, 164.23,  164.1, 164.46, 167.06, 170.71, 172.66, 173.67, 176.13,  173.4, 100.46, 100.86, 101.23, 101.66, 102.11, 102.53,    103, 103.46, 103.95,  104.4, 104.84,  105.3, 105.79,  106.2, 106.65, 107.16, 107.71,  108.1, 108.58, 109.05, 109.55, 110.02, 110.45, 110.92, 111.44, 111.83, 112.36, 112.87, 113.34, 113.81, 114.32, 114.84, 115.42, 115.88, 116.26, 116.72, 117.14, 117.47, 117.96, 118.41, 118.87, 119.37, 119.86, 120.34, 120.88, 121.35, 121.84, 122.39, 122.91, 123.45, 124.09, 124.67, 125.43, 125.97, 126.55,  127.2, 127.87, 128.53, 129.24, 129.95, 130.81,  131.3, 131.91, 132.49,    133, 133.39, 133.83, 134.26, 134.83, 135.19, 135.48, 135.69, 135.89, 136.07, 136.28, 136.49, 136.71,  136.9, 137.11,  137.3, 137.52, 137.73, 137.95, 138.11, 138.25, 138.37, 138.53, 138.66,  138.8, 138.99, 139.09,  139.2, 139.34, 139.44, 139.56, 139.69, 139.81, 139.91, 140.03, 140.15, 140.27, 140.36, 140.52, 140.69, 140.87, 141.06, 141.25, 141.55, 141.79, 142.01, 142.36, 142.68, 143.05, 143.38, 143.72, 144.13, 144.56, 144.95, 145.42, 145.89, 146.34, 146.82, 147.38, 147.92, 148.52, 149.09, 149.72, 150.38, 151.07, 151.64,  152.3, 152.97 ] 
},
"groups": "manager",
"id": "chart319817337dff" 
}
  
  //set description of the data provided in params
  d3.select('.g-table-readin').text( params.description );
  //http://stackoverflow.com/questions/196972/convert-string-to-title-case-with-javascript
  function toTitleCase(str)
    {
        return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
    }
  
  //set table heading to groups
  d3.select('.g-proper-city').text( toTitleCase(params.groups) );
  
  var nytMonths = {"Jan": "Jan.",
                   "Feb": "Feb.",
                   "Mar": "March",
                   "Apr": "April",
                   "May": "May",
                   "Jun": "June",
                   "Jul": "July",
                   "Aug": "Aug.",
                   "Sep": "Sept",
                   "Oct": "Oct.",
                   "Nov": "Nov.",
                   "Dec": "Dec."
                    }

  d3.selection.prototype.moveToFront = function() {
    return this.each(function(){
      this.parentNode.appendChild(this);
    });
  };

  var margin = {top: 20, right: 10, bottom: 1, left: 10},
      width = 950 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;

  var formatYear = d3.time.format("'%y"),
      format = d3.time.format("%m/%d/%y"),
      bisectDate = d3.bisector(function(d) { return d.date; }).left,
      formatToMonth = d3.time.format("%B %Y"),
      formatPercent = d3.format(".1%"),
      formatVal = d3.format(".1f"),
      formatMonAbb = d3.time.format("%b. %Y"),
      formatMonAbb2 = d3.time.format("%b"),
      formatMonthOnly = d3.time.format("%b"),
      formatYearOnly = d3.time.format("%Y"),
      formatPercentChange = d3.format("+%"),
      formatChangeInWords = function (val) {
        var change =  100 - formatNumberWords(val);
        var str = change > 0 ? " percent less" : " percent more";
        if (change < 1 && change > -1 ) {
          return "about the same";
        };
        return (Math.abs(change) + str);
      },
      formatNumberWords = d3.format("0f"),
      formatPercentChange2 = function(d) { return d/100},
      formatFullYear = d3.time.format("%Y"),
      defaultCity = params.data[params.groups][0],
      currentCity,
      hoverCity,
      currentDateIndex,
      defaultDateIndex = 39, //TODO Calculate it!
      currentPriceTier = "val";

  var formatAxes = function(d) {
    var adj = d - 100;
    if (adj == 0) { return "Starting price"; }
    if (adj < 0) { return Math.abs(adj) + "% less"; }
    if (adj > 0) { return Math.abs(adj) + "% more"; }
  };

  var x = d3.time.scale()
      .range([0, width]);

  var y = d3.scale.log()
      .range([height, 0]);

  var barScale = d3.scale.linear()
      .range([0,75])
      .domain([0,75])

  var line = d3.svg.line()
      .x(function(d) { return x(d.date); })
      .y(function(d) { return y(d.adjustedVal); })
      .defined(function(d) { return !isNaN(d.adjustedVal); })

  var slider = d3.select(".g-chart").append("div")
      .attr("class", "g-slider")
      .style("width", width + "px")
      .style("margin-left", margin.left + "px");

  slider.append("div")
      .attr("class", "g-slider-tray")

  var sliderFill = slider.append("div")
      .attr("class", "g-slider-fill")

  var sliderHandle = slider.append("div")
      .attr("class", "g-slider-handle");

    sliderHandle.append("img")
      .attr("class", "g-slider-handle-icon")
      .attr("src", "http://graphics8.nytimes.com/newsgraphics/2013/05/28/case-shiller/2a8c44bdaf0703a2361add917782a6dd88c7d81e/handle@2x.png")

  var svg = d3.select(".g-chart").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .attr("class", "g-svg")
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var xAxis = d3.svg.axis()
      .scale(x)
      .orient("top")
      .ticks(d3.time.years)
      .tickSize(4)
      .tickPadding(2)
      .tickFormat(formatYear);

  var yAxis = d3.svg.axis()
      .scale(y)
      .orient("left")
      .ticks(7)
//      .tickValues( [ 35, 50, 75, 100, 150, 200, 250] )
      .tickSize(-width - margin.left - margin.right)
      .tickFormat(formatAxes);

//  queue()
//      .defer(d3.csv, "http://graphics8.nytimes.com/newsgraphics/2013/05/28/case-shiller/2a8c44bdaf0703a2361add917782a6dd88c7d81e/lookup2.csv")
//      .defer(d3.csv, "http://graphics8.nytimes.com/newsgraphics/2013/05/28/case-shiller/2a8c44bdaf0703a2361add917782a6dd88c7d81e/case-shiller-tiered2.csv")
//      .await(ready)
//
//  function ready(err, lookup, data) {
    data = params.data;
    
    var dataArray = [];
    
    data[d3.keys(data)[0]].forEach(function(d,i) {
      var dataItem = {};
      d3.keys(data).forEach(function(dd) {
        if(dd === 'date'){
          dataItem[dd] = new Date(data[dd][i]);
        } else dataItem[dd] = data[dd][i];
      })
      dataArray.push(dataItem);
    });

    cityNameByKey = {};
    
    //if lookup is undefined just get key:key for each unique
    if (!(typeof(params.lookup) === 'undefined')) {
      lookup = params.lookup;
      lookup.forEach(function(d) {
        cityNameByKey[d.code] = d.city;
      });
    } else {
      lookup = d3.keys(d3.nest().key(function(d){return d[params.groups]}).map(dataArray));
      lookup.forEach(function(d) {
        cityNameByKey[d] = d;
      });
    };

    x.domain(d3.extent(dataArray, function(d) { return d.date; }));
    y.domain(d3.extent(dataArray,function(d){return d.val;}));
    //pad the negative a little on y
    y.domain([50,y.domain()[1]]);

    nested = d3.nest()
        .key(function(d) { return d[params.groups]; })
        .entries(dataArray);

    nested.forEach(function(city) {
      city.updatedMonth = city.values[nested[1].values.length-1].date;
      city.mostRecentValue = city.values[nested[1].values.length-1].val;
      city.maxVal = d3.max(city.values, function(d) { return d.val;});
      city.peakidx = city.values.map(function(d) { return d.val}).indexOf(city.maxVal);
      city.peakMonth = city.values.map(function(d) { return d.date})[city.peakidx];
      city.yearAgoDate = city.values[nested[1].values.length-13].date;
      city.yearAgoVal = city.values[nested[1].values.length-13].val;
      city.yearOnYearChange = (city.mostRecentValue - city.yearAgoVal) / city.yearAgoVal;
      city.changeFromPeak = (city.mostRecentValue - city.maxVal)/(city.maxVal);
      city.changeSinceBeginning = (city.mostRecentValue - city.values[0].val)/city.values[0].val;
      city.proper = cityNameByKey[city.key];
    });

    nested.sort(function(a,b) {
      return b.yearOnYearChange - a.yearOnYearChange;
    });

    var indexFromMouseX = d3.scale.linear()
        .domain([0, width])
        .rangeRound([1, nested[1].values.length - 1])
        .clamp(true)

    svg.append("rect")
        .attr("class", "background")
        .attr("width", width)
        .attr("height", height);

    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + 5 + ")")
        .call(xAxis)
      .selectAll("g")
        .classed("minor", function(d, i) { return d.getFullYear() % 1; })
        .filter(".minor")
      .select("line")
        .attr("y2", 2);

        d3.selectAll(".x.axis text").attr("dy", 20)

    // lines
    var linecontainer = svg.append("g")
        .classed("g-linecontainer", true);

    var screeny = svg.append("rect")
        .classed("g-screen", true)
        .attr("width", 0)
        .attr("height", height)
        .attr("x", 0 - margin.left);

    var yAxisMarker = svg.append("g")
        .attr("class", "y axis")
        .attr("transform", "translate(" + (0) + ",0)")
        .call(yAxis)
      .selectAll("g")
      .classed("minor", true)

        // .classed("minor", function(d,i) { return i !== 0; })
        .classed("g-baseline", function(d) { return d == 100 })
        // .classed("g-first", function(d,i) { return i == 0; })
      .select("text")
        .attr("x", 30)
        .attr("y", -5)
        .attr("dy", null);

    var lines = linecontainer.selectAll("path")
        .data(nested)
      .enter().append("path")
        .attr("class", (function(d) { return ( "g-city-line " + d.key)}) )
        .classed("g-highlight-line", function(d,i) { return d.key == currentCity});

    var hoverbar = svg.append("rect")
        .classed("g-hover-bar", true)
        .attr("width", 2)
        .attr("height", height)
        .attr("x", 0 - margin.left);

    var focus = svg.append("g")
        .attr("class", "focus")
        .attr("transform", "translate(" + x(nested[0].values[0].date) + ", " + y(100) + ")")

    focus.append("circle")
        .attr("r", 5)

    focus.append("text")
        .attr("x", 9)
        .attr("dy", ".35em");

    var currentMonth = slider.append("div")
        .classed("g-current-month", true);

    var mostRecentMonth = slider.append("div")
        .classed("g-most-recent-month", true)
        .html("...to <b>" + "April 2013" + "</b>");

    var endpoint = svg.append("g")
        .attr("class", "g-endpoint")
        .attr("transform", "translate(" + x(nested[0].values[nested[0].values.length-1].date) + ", " + y(100) + ")")

    endpoint.append("circle")
        .attr("r", 5);

    endpoint.append("text")
        .classed("g-end-label g-selected-city-endpoint-label", true)
        .attr("y", -45)
        .attr("x", - 0)
        .text("U.S. 20-city index")

    endpoint.append("text")
        .classed("g-end-label g-selected-city-endpoint-value", true)
        .attr("y", -20)
        .attr("x", - 0)
        .text("+12%")

    //
    //  Init Table
    //
    function initTable() {
      var rows = d3.select(".g-table").selectAll(".table-row")
          .data(nested)
        .enter()
          .append("tr")
          .attr("class", function(d) { return "g-table-row " + d.key + "-row"; })
          .classed("g-selected-row", function(d) { return d.key == "SPCSIND20"});

      var cityNames = rows.append("td")
          .text(function(d) { return d.proper; })
          .classed("g-proper-city", true);

      var yearlyChange = rows.append("td")
          .classed("g-num-td", true)
          .text(function(d) { return formatPercentChange(d.yearOnYearChange); });

      var yearlyChangeBarTd = rows.append("td")
          .classed("g-bar-td", true);

      var yearChangeBarContainer = yearlyChangeBarTd.append("div")
          .classed("g-bar-container", true);

      var changeBar = yearChangeBarContainer.append("div")
          .classed("g-yoy-bar", true)
             .style("width", function(d) {
                var chg = 100 * d.yearOnYearChange;
                return Math.abs(barScale(chg)).toString() + "px";
            })
            .style("left", function(d) {
               var chg = 100 * d.yearOnYearChange;
              if (chg<0) {
                var nudge = Math.abs(barScale(chg));
                return (barScale.domain()[1] - nudge).toString() + "px";
              }
              else {
                return barScale.domain()[1].toString() + "px";
              }
           });

      var zeroMarker3 = yearChangeBarContainer.append("div")
          .classed("g-zeromarker", true)
          .style("left", barScale.domain()[1] + "px");

      var peakMonthTd = rows.append("td")
          .classed("g-num-td", true)
          .text(function(d) {
            return formatPercentChange(d.changeFromPeak);
          });

      var peakMonthBarTd = rows.append("td")
          .classed("g-bar-td", true);

      var peakMonthBarContainer = peakMonthBarTd.append("div")
          .classed("g-bar-container", true);

      var changeBar = peakMonthBarContainer.append("div")
          .classed("g-yoy-bar", true)
          .style("width", function(d) {
             var chg = 100 * d.changeFromPeak;
             return Math.abs(barScale(chg)).toString() + "px";
          })
          .style("left", function(d) {
             var chg = 100 * d.changeFromPeak;
            if (chg < 0) {
              var nudge = Math.abs(barScale(chg));
              return (barScale.domain()[1] - nudge).toString() + "px";
            }
            else {
              return barScale.domain()[1].toString() + "px";
            }
          });

      var zeroMarker2 = peakMonthBarContainer.append("div")
          .classed("g-zeromarker", true)
          .style("left", barScale.domain()[1] + "px");

      var changeSinceSelectedTd = rows.append("td")
          .classed("g-change-since-selected-td g-num-td", true);

      var changeSelectedBarTD = rows.append("td")
          .classed("g-live-change-bar-td", true);

      var liveBarContainer = changeSelectedBarTD.append("div")
          .classed("g-live-bar-container", true);

      var liveChangeBar = liveBarContainer.append("div")
          .classed("g-live-bar", true);

      var zeroMarker = liveBarContainer.append("div")
          .classed("g-zeromarker", true)
          .style("left", barScale.domain()[1] + "px");
    }

    initTable();

    //
    // Init Dropdowns
    //
    var dropDowns = d3.map();
    dropDowns.set("price", {
      class:".g-price-selector",
      data:[["an average priced", "val"], ["a low priced", "low"], ["a medium priced", "mid"], ["a high priced", "high"]],
      change: selectPrice

    });
    dropDowns.set("city", {
      class:".g-city-selector",
      data:nested.map(function(d) {
//
//        if(d.key == "SPCS20R") {
//          return ["a major city", d.key ];
//        }
//        else {
          return [cityNameByKey[d.key], d.key];
//
 //       }

      }).sort(),
      change: selectCity
    });
    dropDowns.set("date", {
      class:".g-date-selector",
      data:nested[0].values.map(function(d, i) { return [formatMonAbb(d.date), i]; }),
      change: selectDateWithIndex
    });

    dropDowns.forEach(function(key, d) {
      d.select = d3.select(d.class)
          .datum(d.data)
        .append("select")
          .on("change", function() { d.change(this.value); });

      d.select.selectAll("option")
          .data(function(d) { return d; })
        .enter().append("option")
          .text(function(d) { return d[0]; })
          .attr("value", function(d) { return d[1]; })
    });

    // TODO make this find the 10-year index instead of hardcode 41 and animate it
    // selectDateWithIndex(1);
    selectCity(defaultCity);
    d3.transition()
        .duration(1000)
        .ease("out")
        .tween("intro", function() {
          return function(t) {
              selectDateWithIndex(Math.round(t * defaultDateIndex));
            };
        })

    //
    // Mouse Events
    //
    svg.on("mousemove", hover);
    svg.on("mouseout", function() {
      unHighlightCity();

      d3.select(".g-tooltip")
          .classed("g-hovering-tooltip", false)
    })

    slider.call(d3.behavior.drag()
        .on("dragstart", dragstarted)
        .on("drag", dragged));

    svg.on("click", function(d) {
      selectCity(hoverCity);
    });

    d3.selectAll(".g-table-row").on("click", function(d) {
      selectCity(d.key);
    }).on("mouseover", function(d) {
      highlightCity(d.key)
    }).on("mouseout", function(d) {
      unHighlightCity(d.key)
    });

    function selectPrice(priceKey) {
      if (currentPriceTier !== priceKey) {
        dropDowns.get("price").select.node().value = priceKey;
        currentPriceTier = priceKey;
        adjustData();
      }
    }

    function selectDateWithIndex(dateIndex) {
      if (currentDateIndex !== dateIndex) {
        currentDateIndex = dateIndex;
        dropDowns.get("date").select.node().value = currentDateIndex;
        adjustData();
      }
    }

    function selectCity(cityKey) {
      cityKey = cityKey ? cityKey : defaultCity;
      if (currentCity !== cityKey) {
        if (isNaN(nested.filter(function(d) { return d.key == cityKey; })[0].values[0][currentPriceTier])) selectPrice("val");
        dropDowns.get("price").select.property("disabled", isNaN(nested.filter(function(d) { return d.key == cityKey; })[0].values[0].low));
        dropDowns.get("city").select.node().value = cityKey;

        currentCity = cityKey;
        d3.selectAll(".g-city-line").classed("g-highlight-line", function(d) { return d.key == cityKey; });
        d3.selectAll(".g-table-row").classed("g-selected-row", function(d) { return d.key == cityKey; });
        d3.select("." + cityKey).moveToFront();
        d3.select(".g-selected-city-endpoint-label").text(cityNameByKey[cityKey])

        updateLabels();
      }
    }

    function updateLabels() {
      var obj = nested.filter(function(d) { return d.key == currentCity})[0]
      var lastVal = obj.values[obj.values.length-1].adjustedVal;
      d3.select(".g-answer").text(formatChangeInWords(lastVal));
      d3.select(".g-selected-city-endpoint-value").text(formatChangeInWords(lastVal))
      d3.select(".g-endpoint")
          .attr("transform", "translate(" + x(obj.values[obj.values.length-1].date) + ","+ y(lastVal)+")" );
    }

    function highlightCity(cityKey) {
      if (hoverCity !== cityKey) {

        hoverCity = cityKey;
        d3.selectAll(".g-city-line").classed("g-hover-line", function(d) { return d.key == cityKey; });
        d3.selectAll(".g-table-row").classed("g-hover-row", function(d) { return d.key == cityKey; });
      }
    }

    function unHighlightCity() {
      if (hoverCity !== null) {
        hoverCity = null;
        d3.selectAll(".g-city-line").classed("g-hover-line", false);
        d3.selectAll(".g-table-row").classed("g-hover-row", false);

        d3.select(".g-tooltip")
            .classed("g-hovering-tooltip", false)
      }
    }

    function dragstarted() {
      unHighlightCity();
      dragged();
      d3.event.sourceEvent.preventDefault();
    }

    function dragged() {
      selectDateWithIndex(indexFromMouseX(d3.mouse(svg.node())[0]));
    }

    function hover() {
      var m = d3.mouse(svg.node()),
          index = indexFromMouseX(m[0]),
          pct = y.invert(m[1]);

      var closestDifference = Infinity,
          closestIndex = -1,
          currentDifference;

      nested.forEach(function(d, i) {
        currentDifference = Math.abs(pct - d.values[index].adjustedVal);
        if (currentDifference < closestDifference) {
          closestDifference = currentDifference;
          closestIndex = i;
        }
      });

      if (closestDifference < 30) {
        highlightCity(nested[closestIndex].key);

        var m = d3.mouse(svg.node());
        d3.select(".g-tooltip")
            .classed("g-hovering-tooltip", true)
            .style("left", m[0] + "px")
            .style("top", m[1] + 70 + "px")
            .text(cityNameByKey[nested[closestIndex].key]);

        svg.style("cursor", "pointer");
      } else {
        svg.style("cursor", "inherit");

        unHighlightCity();
      }
    }

    function adjustData() {
      nested.forEach(function(d) {
        d.values.forEach(function(j) {
          j.adjustedVal = 100 * (j[currentPriceTier] / d.values[currentDateIndex][currentPriceTier]);
        })
      });

      lines.attr("d", function(d) { return line(d.values); } );

      var thisDate = nested[0].values[currentDateIndex].date,
          xPos = x(thisDate)

      var newpos = xPos < 100 ? 60 : (xPos - 40);
      // when xpos is less than 50, freeze it at 100
      d3.selectAll(".y.axis .tick.minor text")
        .attr("transform", "translate(" + newpos + ",0)")

      focus.attr("transform", "translate(" + (xPos - 2) + "," + y(100) + ")");

      d3.select(".g-date-compare")
          .text(function(d) { return ("Since " + nytMonths[formatMonthOnly(thisDate)] + " " + formatYearOnly(thisDate)   )})

      d3.select(".g-screen").attr("width", xPos + 10 );

      if (xPos) {};

      currentMonth
          .style("left", Math.min(Math.max(xPos - 160, 0), width - 320) + "px")
          .html(function(d) {  return "Price changes from <b>" + nytMonths[formatMonAbb2(thisDate)] + " " +  formatYearOnly(thisDate) +  "</b>..." });

      sliderFill.style("width",  (width - x(thisDate)) + "px" );

      sliderHandle.style("left", xPos + "px")

      d3.select(".g-hover-bar").attr("x", xPos - 2 );

      d3.selectAll(".g-change-since-selected-td")
          .text(function(d) {
            var current = d.values[d.values.length-1].val
            var compareVal = d.values[currentDateIndex].val;
            var chg = (current - compareVal ) / compareVal;
            return formatPercentChange(chg);
          });

      var thisCityObj = nested.filter(function(d) { return d.key == currentCity})[0];

      updateLabels();

      d3.selectAll(".g-live-bar")
          .style("width", function(d) {
              var current = d.values[d.values.length-1].val
              var compareVal = d.values[currentDateIndex].val;
              var chg = 100 * (current - compareVal ) / compareVal;
              return Math.abs(barScale(chg)).toString() + "px";
          })
          .style("left", function(d) {
            var current = d.values[d.values.length-1].val
            var compareVal = d.values[currentDateIndex].val;
            var chg = 100 * (current - compareVal ) / compareVal;

            if (chg < 0) {
              var nudge = Math.abs(barScale(chg));
              return (barScale.domain()[1] - nudge).toString() + "px";
              // what fraction of the width in pixels is this?
              var nudge = starterBarWidth * Math.abs(chg)/100;
              return (starterBarWidth - nudge).toString() + "px";
            }
            else {
              return barScale.domain()[1].toString() + "px";
            }
         });
    }
  //}

})()</script>

    </div>
        
</body>
  <script src="libraries/frameworks/bootstrap/js/vendor/bootstrap.min.js"></script>
  <script src="libraries/frameworks/bootstrap/js/plugins.js"></script>
  <script src="libraries/frameworks/bootstrap/js/main.js"></script>
  <!-- Load Javascripts for Widgets -->
  
  <!-- Google Prettify -->
  <script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
  <script src='libraries/highlighters/prettify/js/lang-r.js'></script>
  <script>
    var pres = document.getElementsByTagName("pre");
    for (var i=0; i < pres.length; ++i) {
      pres[i].className = "prettyprint linenums";
    }
    prettyPrint();
  </script>
  <!-- End Google Prettify --> 
  </html>